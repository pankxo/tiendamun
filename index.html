<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shampoo Sólido - Tienda Mun</title>
  <meta name="description" content="Compra shampoos sólidos naturales en Tienda Mun. Envíos a todo Chile, pago seguro con Mercado Pago.">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Mercado Pago SDK -->
  <script src="https://sdk.mercadopago.com/js/v2"></script>
  
  <style>
    /* CSS Variables for theming */
    :root {
      --bg-cream: #faf9f7;
      --bg-white: #ffffff;
      --text-dark: #2d3748;
      --text-gray: #4a5568;
      --text-light: #718096;
      --border-light: #e2e8f0;
      --accent-blue: #4299e1;
      --accent-green: #48bb78;
      --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.1);
      --shadow-medium: 0 4px 6px rgba(0, 0, 0, 0.1);
      --shadow-heavy: 0 10px 25px rgba(0, 0, 0, 0.15);
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg-cream);
      color: var(--text-dark);
      line-height: 1.6;
    }

    /* Search Bar - iPhone style */
    .search-bar {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-light);
      padding: 0.75rem 1rem;
    }

    .search-container {
      max-width: 500px;
      margin: 0 auto;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      border: 1px solid var(--border-light);
      border-radius: 20px;
      background: var(--bg-white);
      font-size: 16px;
      outline: none;
      transition: border-color 0.2s ease;
    }

    .search-input:focus {
      border-color: var(--accent-blue);
    }

    .search-icon {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-light);
      pointer-events: none;
    }

    /* Main container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    /* Layout */
    .layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
      align-items: start;
    }

    @media (max-width: 768px) {
      .layout {
        grid-template-columns: 1fr;
        gap: 2rem;
      }
    }

    /* Left section - Product visual */
    .left {
      background: var(--bg-white);
      border-radius: var(--radius-lg);
      padding: 2rem;
      box-shadow: var(--shadow-light);
      position: sticky;
      top: 8rem;
    }

    .product-visual {
      text-align: center;
    }

    .badge {
      display: inline-block;
      background: var(--accent-green);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .img-wrap {
      width: 250px;
      height: 250px;
      margin: 0 auto 1.5rem;
      border-radius: var(--radius-lg);
      overflow: hidden;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .img-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .img-wrap .placeholder {
      color: white;
      font-size: 1.125rem;
      font-weight: 600;
      text-align: center;
    }

    #leftTitle {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0 0 0.5rem;
      color: var(--text-dark);
    }

    #leftDesc {
      color: var(--text-gray);
      margin: 0;
    }

    /* Right section - Controls */
    .right {
      background: var(--bg-white);
      border-radius: var(--radius-lg);
      padding: 2rem;
      box-shadow: var(--shadow-light);
    }

    .right h1 {
      font-size: 2rem;
      font-weight: 700;
      margin: 0 0 0.5rem;
      color: var(--text-dark);
    }

    .sub {
      color: var(--text-gray);
      margin-bottom: 2rem;
    }

    /* Screen reader only */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Chips for product types */
    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 2rem;
    }

    .chip {
      background: var(--bg-cream);
      border: 2px solid transparent;
      border-radius: 2rem;
      padding: 0.5rem 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
      color: var(--text-dark);
    }

    .chip:hover {
      background: #e2e8f0;
    }

    .chip[aria-pressed="true"] {
      background: var(--accent-blue);
      color: white;
      border-color: var(--accent-blue);
    }

    /* Info card */
    .info-card {
      background: var(--bg-cream);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid var(--border-light);
    }

    .info-card h3 {
      font-size: 1.125rem;
      font-weight: 600;
      margin: 0 0 0.75rem;
      color: var(--text-dark);
    }

    .info-card p {
      margin: 0 0 1rem;
      color: var(--text-gray);
    }

    .info-card ul {
      margin: 0;
      padding-left: 1.25rem;
      color: var(--text-gray);
    }

    .info-card li {
      margin-bottom: 0.25rem;
    }

    /* Size and quantity row */
    .size-row {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .size-btn {
      background: var(--bg-cream);
      border: 2px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 600;
      color: var(--text-dark);
    }

    .size-btn:hover {
      border-color: var(--accent-blue);
    }

    .size-btn.active {
      background: var(--accent-blue);
      color: white;
      border-color: var(--accent-blue);
    }

    .qty-row {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .stepper {
      display: flex;
      align-items: center;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    .stepper button {
      background: var(--bg-white);
      border: none;
      padding: 0.5rem 0.75rem;
      cursor: pointer;
      transition: background-color 0.2s ease;
      font-weight: 600;
      color: var(--text-dark);
    }

    .stepper button:hover {
      background: var(--bg-cream);
    }

    .stepper input {
      border: none;
      padding: 0.5rem 0.75rem;
      text-align: center;
      width: 60px;
      background: var(--bg-white);
      color: var(--text-dark);
      font-weight: 600;
    }

    .price-line {
      text-align: right;
    }

    #priceText {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-dark);
      display: block;
    }

    #unitLabel {
      font-size: 0.875rem;
      color: var(--text-light);
    }

    /* Price table */
    .price-table {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
      background: var(--bg-cream);
      border-radius: var(--radius-md);
      padding: 1rem;
      margin-bottom: 2rem;
      font-weight: 600;
    }

    .price-table > div:nth-child(odd) {
      color: var(--text-gray);
    }

    .price-table > div:nth-child(even) {
      text-align: right;
      color: var(--text-dark);
    }

    /* Action buttons */
    .actions {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .btn {
      flex: 1;
      min-width: 160px;
      padding: 0.875rem 1.5rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      text-decoration: none;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 2px solid transparent;
      font-size: 0.875rem;
    }

    .btn-outline {
      background: transparent;
      color: var(--accent-green);
      border-color: var(--accent-green);
    }

    .btn-outline:hover {
      background: var(--accent-green);
      color: white;
    }

    .btn-primary {
      background: var(--accent-blue);
      color: white;
      border-color: var(--accent-blue);
    }

    .btn-primary:hover {
      background: #3182ce;
      border-color: #3182ce;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Meta info */
    .meta {
      text-align: center;
      color: var(--text-light);
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }

    /* Banner */
    .banner {
      background: #fef3cd;
      border: 1px solid #fde68a;
      border-radius: var(--radius-md);
      padding: 1rem;
      margin-top: 1rem;
      color: #92400e;
      font-size: 0.875rem;
      text-align: center;
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }

      .left {
        position: static;
      }

      .img-wrap {
        width: 200px;
        height: 200px;
      }

      .size-row {
        flex-direction: column;
        align-items: stretch;
      }

      .qty-row {
        justify-content: space-between;
      }

      .actions {
        flex-direction: column;
      }

      .btn {
        flex: none;
        min-width: auto;
      }
    }
  </style>
</head>
<body>
  <!-- Search Bar -->
  <div class="search-bar">
    <div class="search-container">
      <div class="search-icon">🔍</div>
      <input 
        type="search" 
        class="search-input" 
        id="search" 
        placeholder="Buscar tipo de shampoo..."
        aria-label="Buscar productos"
      >
    </div>
  </div>

  <main>
    <div class="container">
      <div class="layout">
        <!-- Left: Imagen + descripción que cambian según tipo -->
        <section class="left" aria-live="polite">
          <div class="product-visual">
            <span class="badge" id="leftBadge">Recomendado</span>
            <div class="img-wrap">
              <div class="placeholder" id="productImage">Imagen del Producto</div>
            </div>
            <div>
              <h2 id="leftTitle">Shampoo Sólido</h2>
              <p id="leftDesc">Selecciona un tipo para ver detalles, imagen y precios.</p>
            </div>
          </div>
        </section>

        <!-- Right: Selector, info, tamaño, cantidad y acciones -->
        <section class="right">
          <h1>Elige tu shampoo</h1>
          <div class="sub">Busca por tipo, revisa ingredientes y beneficios, elige gramos, cantidad y paga.</div>

          <div>
            <label class="sr-only" for="tipo">Tipo de shampoo</label>
            <div id="chipsWrap" class="chips" role="listbox" aria-label="Tipos de shampoo">
              <!-- chips dinámicos -->
            </div>
          </div>

          <div class="info-card" id="infoCard">
            Elige un tipo para ver su Descripción, Ingredientes y Beneficios.
          </div>

          <div class="size-row" role="group" aria-label="Selecciona tamaño">
            <button class="size-btn" id="size60" data-size="60" type="button">60 g</button>
            <button class="size-btn" id="size100" data-size="100" type="button">100 g</button>

            <div class="qty-row" style="margin-left:auto">
              <div class="stepper" aria-label="Cantidad">
                <button type="button" id="decr" aria-label="Disminuir">−</button>
                <input id="qty" type="text" value="1" inputmode="numeric" aria-live="off" readonly>
                <button type="button" id="incr" aria-label="Aumentar">+</button>
              </div>
              <div class="price-line">
                <span id="priceText">$0</span>
                <small id="unitLabel">/ unidad</small>
              </div>
            </div>
          </div>

          <div class="price-table" id="priceTable" aria-live="polite"></div>

          <div class="actions">
            <a id="whatsappBtn" class="btn btn-outline" target="_blank" rel="noopener">Contactar por WhatsApp</a>
            <button id="checkoutBtn" class="btn btn-primary" type="button">Pagar con Mercado Pago</button>
          </div>

          <div class="meta">
            <span id="shipText">Envíos a todo Chile</span> •
            <span>Pagos 100% seguros con Checkout Pro</span>
          </div>

          <div class="banner" id="mpBanner" style="display:none">
            Para habilitar el pago, configura tu Public Key y el endpoint de preferencia de Mercado Pago.
          </div>
        </section>
      </div>
    </div>
  </main>

  <script>
    // Constants
    const MERCADOPAGO_PUBLIC_KEY = 'TEST-00000000-0000-0000-0000-000000000000';
    const MERCADOPAGO_LOCALE = 'es-CL';
    const BACKEND_PREFERENCE_ENDPOINT = '/api/mercadopago/preference';
    const WHATSAPP_PHONE = '5491112345678';
    const CURRENCY = 'CLP';
    const PLACEHOLDER_IMG = '';

    // Product catalog
    const SHAMPOOS = [
      {
        id: 'anticaida',
        nombre: 'Cabello Anticaída',
        breve: 'Fortalece y estimula el crecimiento del cabello',
        tags: ['Anticaída', 'Fortalecedor'],
        img: '',
        precios: { 60: 7000, 100: 11000 },
        info: {
          descripcion: 'Fortalece el cabello y estimula su crecimiento.',
          ingredientes: [
            'Amla en polvo (fortalece raíces)',
            'Ortiga en polvo (estimula circulación)', 
            'Betaína de coco (limpieza suave)',
            'Aceite de ricino (fortalece y acondiciona)'
          ],
          beneficios: [
            'Fortalece raíces',
            'Mejora circulación',
            'Reduce caída',
            'Acondiciona'
          ]
        }
      },
      {
        id: 'menta',
        nombre: 'Menta Refrescante',
        breve: 'Refrescante y revitalizante para el cabello graso',
        tags: ['Refrescante', 'Cabello Graso'],
        img: '',
        precios: { 60: 7000, 100: 11000 },
        info: {
          descripcion: 'Próximamente',
          ingredientes: ['Próximamente'],
          beneficios: ['Próximamente']
        }
      },
      {
        id: 'romero',
        nombre: 'Romero Nutritivo',
        breve: 'Nutritivo y fortalecedor con extracto de romero',
        tags: ['Nutritivo', 'Fortalecedor'],
        img: '',
        precios: { 60: 7000, 100: 11000 },
        info: {
          descripcion: 'Próximamente',
          ingredientes: ['Próximamente'],
          beneficios: ['Próximamente']
        }
      },
      {
        id: 'aloe',
        nombre: 'Aloe Vera Hidratante',
        breve: 'Hidratante suave con aloe vera natural',
        tags: ['Hidratante', 'Suave'],
        img: '',
        precios: { 60: 7000, 100: 11000 },
        info: {
          descripcion: 'Próximamente',
          ingredientes: ['Próximamente'],
          beneficios: ['Próximamente']
        }
      },
      {
        id: 'carbon',
        nombre: 'Carbón Activado',
        breve: 'Purificante y desintoxicante con carbón activado',
        tags: ['Purificante', 'Desintoxicante'],
        img: '',
        precios: { 60: 7000, 100: 11000 },
        info: {
          descripcion: 'Próximamente',
          ingredientes: ['Próximamente'],
          beneficios: ['Próximamente']
        }
      }
    ];

    // Global state
    let selectedType = null;
    let selectedSize = 60;
    let qty = 1;
    let mp = null;
    let mpReady = false;

    // DOM elements
    const productImage = document.getElementById('productImage');
    const leftTitle = document.getElementById('leftTitle');
    const leftDesc = document.getElementById('leftDesc');
    const leftBadge = document.getElementById('leftBadge');
    const infoCard = document.getElementById('infoCard');
    const priceTable = document.getElementById('priceTable');
    const priceText = document.getElementById('priceText');
    const unitLabel = document.getElementById('unitLabel');

    // Initialize Mercado Pago
    function initMercadoPago() {
      if (MERCADOPAGO_PUBLIC_KEY === 'TEST-00000000-0000-0000-0000-000000000000') {
        document.getElementById('mpBanner').style.display = 'block';
        document.getElementById('checkoutBtn').disabled = true;
        return;
      }
      
      try {
        mp = new MercadoPago(MERCADOPAGO_PUBLIC_KEY, { locale: MERCADOPAGO_LOCALE });
        mpReady = true;
        console.log('Mercado Pago initialized successfully');
      } catch (err) {
        console.error('Error initializing Mercado Pago:', err);
        document.getElementById('mpBanner').style.display = 'block';
        document.getElementById('checkoutBtn').disabled = true;
      }
    }

    // Utility functions
    function fmtCurrency(amount) {
      return new Intl.NumberFormat('es-CL', { style: 'currency', currency: CURRENCY }).format(amount);
    }

    function getCurrent() {
      const type = SHAMPOOS.find(s => s.id === selectedType);
      const unit = type?.precios?.[selectedSize] || 0;
      const total = unit * qty;
      return { type, unit, total };
    }

    function renderChips(filter = '') {
      const chipsWrap = document.getElementById('chipsWrap');
      chipsWrap.innerHTML = '';
      
      SHAMPOOS
        .filter(s => !filter || s.nombre.toLowerCase().includes(filter.toLowerCase()))
        .forEach(shampoo => {
          const chip = document.createElement('button');
          chip.className = 'chip';
          chip.textContent = shampoo.nombre;
          chip.setAttribute('data-id', shampoo.id);
          chip.setAttribute('role', 'option');
          chip.setAttribute('aria-pressed', 'false');
          chip.addEventListener('click', () => setSelectedType(shampoo.id));
          chipsWrap.appendChild(chip);
        });
    }

    function renderInfo(item) {
      infoCard.innerHTML = `
        <h3>Descripción</h3>
        <p>${item.info?.descripcion || "Próximamente"}</p>
        <h3>Ingredientes principales</h3>
        <ul>${(item.info?.ingredientes||[]).map(i=>`<li>${i}</li>`).join('') || "<li>Próximamente</li>"}</ul>
        <h3>Beneficios</h3>
        <ul>${(item.info?.beneficios||[]).map(b=>`<li>${b}</li>`).join('') || "<li>Próximamente</li>"}</ul>
      `;
      priceTable.innerHTML = `
        <div>60 g</div><div>${fmtCurrency(item.precios[60]||0)}</div>
        <div>100 g</div><div>${fmtCurrency(item.precios[100]||0)}</div>
      `;
    }

    function updatePrice(){
      const { unit, total } = getCurrent();
      priceText.textContent = fmtCurrency(total || 0);
      unitLabel.textContent = unit ? `/ ${fmtCurrency(unit)} c/u` : '/ unidad';
    }

    function setSelectedType(id){
      selectedType = id;
      const item = SHAMPOOS.find(s => s.id === id);
      if (!item) return;
      
      renderInfo(item);
      productImage.textContent = item.nombre;
      leftTitle.textContent = item.nombre;
      leftDesc.textContent = item.breve || '';
      leftBadge.textContent = (item.tags||[]).slice(0,2).join(" • ") || "Recomendado";
      updatePrice();
      updateWhatsAppLink();
      
      document.querySelectorAll('.chip').forEach(ch => 
        ch.setAttribute('aria-pressed', ch.getAttribute('data-id')===id ? 'true':'false')
      );
    }

    function setSelectedSize(size) { 
      selectedSize = size; 
      document.getElementById('size60').classList.toggle('active', size === 60); 
      document.getElementById('size100').classList.toggle('active', size === 100); 
      updatePrice(); 
      updateWhatsAppLink(); 
    }

    function setQty(n) { 
      qty = Math.max(1, Math.min(99, n|0)); 
      document.getElementById('qty').value = qty; 
      updatePrice(); 
      updateWhatsAppLink(); 
    }

    function updateWhatsAppLink(){
      const { type, unit, total } = getCurrent();
      const title = type ? `${type.nombre} ${selectedSize}g` : 'Shampoo';
      const msg = `Hola! Quiero consultar por:\n- ${title}\n- Cantidad: ${qty}\n- Precio unitario: ${fmtCurrency(unit)}\n- Total estimado: ${fmtCurrency(total)}\n\n¿Tienen stock?`;
      document.getElementById('whatsappBtn').href = `https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(msg)}`;
    }

    async function createPreference(){
      const { type, unit } = getCurrent();
      if (!type || !unit) { 
        alert("Selecciona un tipo y tamaño para continuar."); 
        return null; 
      }
      
      const itemTitle = `${type.nombre} ${selectedSize}g`;
      const payload = { 
        title: itemTitle, 
        quantity: qty, 
        unit_price: unit, 
        currency_id: CURRENCY, 
        picture_url: type.img || PLACEHOLDER_IMG, 
        category_id: "personal_care", 
        description: (type.info?.descripcion || itemTitle).slice(0, 250) 
      };
      
      const res = await fetch(BACKEND_PREFERENCE_ENDPOINT, { 
        method: "POST", 
        headers: {"Content-Type":"application/json"}, 
        body: JSON.stringify(payload) 
      });
      
      if (!res.ok) { 
        throw new Error(`Error creando preferencia: ${res.status} ${await res.text()}`); 
      }
      
      const data = await res.json();
      return data.id;
    }

    async function handleCheckout(){
      if (!mp || !mpReady) { 
        alert("Configura tu Public Key y endpoint de preferencia para habilitar el pago."); 
        return; 
      }
      
      const btn = document.getElementById('checkoutBtn');
      btn.disabled = true; 
      btn.textContent = "Preparando pago...";
      
      try {
        const prefId = await createPreference();
        if (!prefId) return;
        mp.checkout({ preference: { id: prefId }, autoOpen: true, render: { container: null } });
      } catch (err) { 
        console.error(err); 
        alert("No se pudo iniciar el pago. Intenta nuevamente."); 
      } finally { 
        btn.disabled = false; 
        btn.textContent = "Pagar con Mercado Pago"; 
      }
    }

    // Event listeners
    document.getElementById('search').addEventListener('input', (e) => renderChips(e.target.value));
    document.getElementById('size60').addEventListener('click', () => setSelectedSize(60));
    document.getElementById('size100').addEventListener('click', () => setSelectedSize(100));
    document.getElementById('decr').addEventListener('click', () => setQty(qty - 1));
    document.getElementById('incr').addEventListener('click', () => setQty(qty + 1));
    document.getElementById('checkoutBtn').addEventListener('click', handleCheckout);
    document.getElementById('qty').addEventListener('keydown', (e) => { 
      if (e.key === 'Enter') e.preventDefault(); 
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      initMercadoPago();
      setSelectedSize(60);
      renderChips("");
      
      // Set shipping text based on locale
      const shipText = document.getElementById('shipText');
      const countryByLocale = { 
        "es-AR": "Envíos a toda Argentina", 
        "es-CL": "Envíos a todo Chile", 
        "es-MX": "Envíos a todo México", 
        "es-UY": "Envíos a todo Uruguay", 
        "es-PE": "Envíos a todo Perú" 
      };
      shipText.textContent = countryByLocale[MERCADOPAGO_LOCALE] || "Envíos a todo el país";
    });
  </script>
</body>
</html>